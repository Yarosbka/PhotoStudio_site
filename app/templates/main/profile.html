{% extends "base.html" %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <!-- –°–∞–π–¥–±–∞—Ä -->
        <div class="col-md-4 mb-4">
            <div class="card border-0 shadow-sm rounded-4 p-4 text-center sticky-top" style="top: 150px; z-index: 1;">
                <div class="mb-3">
                    {% if current_user.avatar_path %}
                        <div class="rounded-circle overflow-hidden d-inline-block shadow-sm" style="width: 100px; height: 100px;">
                            <img src="{{ url_for('static', filename='uploads/' + current_user.avatar_path) }}" 
                                 alt="Avatar" class="w-100 h-100 object-fit-cover">
                        </div>
                    {% else %}
                        <div class="rounded-circle bg-light d-inline-flex align-items-center justify-content-center" style="width: 100px; height: 100px;">
                            <span class="display-4 fw-bold text-dark">{{ current_user.full_name[0] }}</span>
                        </div>
                    {% endif %}
                </div>
                <h4 class="fw-bold">{{ current_user.full_name }}</h4>
                <p class="text-muted">{{ current_user.email }}</p>
                <hr>
                <div class="d-grid gap-2 text-start">
                    <a href="{{ url_for('main.profile') }}" class="btn btn-light rounded-pill text-start px-3 active fw-bold">üì¶ –ú–æ–∏ –∑–∞–∫–∞–∑—ã</a>
                    <a href="{{ url_for('main.settings') }}" class="btn btn-white text-start px-3">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                    <a href="{{ url_for('auth.logout') }}" class="btn btn-white text-start text-danger px-3">üö™ –í—ã–π—Ç–∏</a>
                </div>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="col-md-8">
            <h2 class="brand-font mb-4">–ò–°–¢–û–†–ò–Ø –ó–ê–ö–ê–ó–û–í</h2>
            
            {% if orders %}
                <div class="d-flex flex-column gap-3">
                {% for order in orders %}
                    <div class="card border border-light rounded-4 p-3 shadow-sm">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="badge bg-light text-dark border rounded-pill">–ó–∞–∫–∞–∑ #{{ order.id }}</span>
                            <span class="text-muted small">{{ order.booking_datetime.strftime('%d.%m.%Y %H:%M') }}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="fw-bold mb-0">
                                    {% for item in order.items %}{{ item.service.name }}{% endfor %}
                                </h5>
                                <p class="mb-0 text-secondary">{{ order.total_price }} ‚ÇΩ</p>
                            </div>
                            <div>
                                {% if order.status == 'pending' %}
                                    <span class="badge bg-warning text-dark rounded-pill">–û–∂–∏–¥–∞–µ—Ç</span>
                                {% elif order.status == 'confirmed' %}
                                    <span class="badge bg-success rounded-pill">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω</span>
                                {% else %}
                                    <span class="badge bg-secondary rounded-pill">{{ order.status }}</span>
                                {% endif %}
                            </div>
                        </div>
                        {% if order.status == 'pending' %}
                        <div class="mt-3 text-end">
                            <!-- –ë—ã–ª–æ: <a href="#" class="btn btn-sm btn-dark rounded-pill">–û–ø–ª–∞—Ç–∏—Ç—å</a> -->

<!-- –°—Ç–∞–ª–æ (–∏–º–∏—Ç–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∞): -->
                            <a href="{{ url_for('main.check_payment', order_id=order.id, simulation='true') }}" class="btn btn-sm btn-dark rounded-pill px-3">–û–ø–ª–∞—Ç–∏—Ç—å</a>
                        </div>
                        {% endif %}
                    </div>
                {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-light border rounded-4 text-center py-5">
                    <p class="mb-3">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤.</p>
                    <a href="{{ url_for('main.catalog') }}" class="btn-custom-black">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}